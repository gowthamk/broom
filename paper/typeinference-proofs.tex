Invariants, other points, and to-dos:
\begin{itemize}
  \item use of a set to represent conjunctions
  \item equality is shorthand for two inequalities
  \item unify notation for substitution
  \item substitution required in correctness theorem as well
  \item use of alpha-renaming, and its use to discharge not-in contraints;
also, incorporate this into first stage rather than second (in Fig. 7).
  \item Modify CSP definition to be same as preceding; we can define the $\Delta$s 
    as auxiliary notation
  \item Note that we can also clarify that the well-formedness constraints are
    syntactic sugar from basic set constraints
  \item Every predicate variable has a single domain-constraint.
  \item Prove: Progress: Every region-variable will be unified with some constant.
  \item Notation: should we use a different notation to distinguish a validity constraint
    from actual entailment?
  \item Proof by relating proof-trees with constraint-generation trees; each can
    be constructed from the other; inductive lemma is as earlier
\end{itemize}

\begin{lemma}
The antecedent of any generated validity constraint is of the form
$\varphi \conj \phictxt$ where $\varphi$ is a predicate variable and
$\phictxt$ is a conjunction of zero or more outlives-constraints.
Let $\pi_1 \outlives \pi_2$ be a conjunct in $\phictxt$.
Then, $\pi_2 \notin \predDeltaMap(\varphi)$.
Furthermore, if $\pi_1 \in \predDeltaMap(\varphi)$, then for
every $\pi_f \in \predDeltaMap(\varphi)$, $\pi_f \outlives \pi_2$ is
a conjunct in $\phictxt$.
\end{lemma}

\begin{proof}
  By induction over the constraint-generation rules.
  Any context $\A = (\rhoenv,\aenv,\phicx)$ generated by the constraint-generation
  process satisfies the invariant that $\phicx$ is of the form $\varphi \conj \phictxt$
  where $\rhoenv \supseteq \predDeltaMap(\varphi)$.
  The only rule that modifies $\phicx$ is the rule for \C{letregion}
  that adds the set of constraints $\pi_f \outlives \pi$ for every $\pi_f \in \rhoenv$
  as conjuncts to $\phicx$.
\end{proof}

\begin{lemma}
  Consider any constraint satisfying the above invariant with a rhs of the
  form $\pi_i \outlives \pi_j$, with both $\pi_i$ and $\pi_j$ region constants.
  (a) If $\{ \pi_i, \pi_j \} \subseteq \predDeltaMap(\varphi)$,
  then $\isvalid{\varphi}{\pi_i \outlives \pi_j}$ in any solution to the constraints.
  (b) If $\{ \pi_i, \pi_j \} \not \subseteq \predDeltaMap(\varphi)$,
  then $\isvalid{\phicx}{\pi_i \outlives \pi_j}$ in any solution to the constraints.
\end{lemma}

\begin{theorem}
Let $p$, $q$, $r$ and $C$ denote the values of the corresponding
variables in an execution of the type inference algorithm.
\begin{enumerate}
\item $\absof{q}$ = $p$
\item $\absof{q[\sigma]}$ = $p$ for any substitution $\sigma$.
\item If $\sigma$ is any solution to $C$, then $q[\sigma]$ is well-typed.
\item If there is any substitution $\sigma$ such that $q[\sigma]$ is well-typed, then
$C$ has a solution.
\item If SolveConstraints($C$) returns Some($s$), then $s$ is a solution to $C$.
\item If $C$ has a  solution, then SolveConstraints($C$) will return some solution.
\end{enumerate}
\end{theorem}
