\begin{figure*}

\textbf{Method Well-formedness}  \; \fbox
  {\(d \; \mathtt{ok \; in} \; B \)}\\
%
\begin{minipage}{5.5in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
    \rhoenv = \{\rhoalloc,\rhobar,\rhoalloc_m,\bar{\rho_m}\} \spc
    \aenv = [\bar{\tyvar} \mapsto \bar{\fgjN}] \spc
    \phicx = \phi \conj \phi_m \spc
    \A = (\subtypcx)\spc
    \tywf{\rhoenv}{\phi_m} \\
    \tywf{\A}{\bar{\tau^1},\tau^2} \spc
%   \tywf{\A}{\tau^2} \spc
    \headerOf{B}\{...\}\spc
    \env = \cdot[\xbar\mapsto\bar{\tau^1}][\thisZ\mapsto
            B\inang{\bar{\tyvar}}\inang{\rhoalloc\rhobar}] \\
    \override(m,\fbN,\inang{\rhoallocm\rhobarm \,|\, \phi_m}\bar{\tau^1} 
             \rightarrow \tau^2) \spc
%   \stmtsem{\rhoallocm}{s}{\stmtsemcx}{\stmtsemcxp}\spc
    \hastyp{\exptycx{\rhoallocm}{\env}}{e}{\tau} \spc
    \subtyp{\A}{\tau}{\tau^2}
  }
  {
    \okin 
        {\tau^2 \; m\inang{\rhoallocm\rhobarm \,|\, \phi_m}
              (\bar{\tau^1}\;\xbar)\{\C{return}\,e;\}}
        {B}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
\bigskip

\textbf{Class Well-formedness}  \; \fbox
  {\(B \; \mathtt{ok}\)}\\
%
\begin{minipage}{5.5in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
    \rhoenv = \{\rhoalloc,\rhobar\} \spc
    \aenv = [\bar{\tyvar} \mapsto \bar{\fgjN}] \spc
    \phicx = \phi \spc
    \A = (\subtypcx)\spc
    \tywf{\rhoenv}{\phi} \\
    \fgjtywf{\aenv}{\bar{\fgjN}} \spc
    \tywf{\A}{\fbN,\bar{\tau^f}} \spc
    \shape(\fbN) \neq \RgnZ\inang{T}\spc 
%   \tywf{\A}{\bar{\tau^f}} \spc
    \isvalid{\phicx}{allocRgn(\bar{\tau^f}) \outlives \rho^a} \\
    \ctype(\fbN) = \bar{\tau^{\fbN}} \spc
    k = B(\bar{\tau^f}\;\xbar,\bar{\tau^{\fbN}}\;\bar{y})
        \{\superZ(\xbar);\,\thisZ.\bar{f} = \bar{y};\} \spc
    \okin{\bar{d}}{B}
  }
  {
    {\headerOf{B}\{\bar{\tau^f}\;\bar{f};\,k\;\bar{d}\}} \;{\texttt{ok}}
  }
\end{array}
\end{smathpar}
\end{minipage}
%

\caption{\fbname: Method and Class Well-formedness}
\label{fig:fb-morewfrules}
\end{figure*}
