\begin{figure}[t!]
\begin{numcodejava}
class MapVertex<TIn, TOut> extends NaiadVertex{
  Func<TIn, TOut> udf;
  SortedMap<TTime, List<TOut>> map;
  ...
  void onReceive(Time t, TIn inp) {
    if (!this.map.containsKey(t))
      this.map.put(t, new List<TOut>());
    TOut outp = this.udf.apply(inp);
    this.map.get(t).add(outp);
  }
  void onNotify(Time t) {
    List<TOut> outps = new List<TOut>();
    Iterator<Pair<Time, List<TOut>>> iter = 
        // entries(0,t):  map entries with keys 
        // between (and including) 0 & t
        this.map.entries(0,t).iterator();
    while(iter.hasNext()) {
      Pair<Time, List<TOut>> p = iter.getNext();
      outps.addAll(p.getSnd());
      this.map.remove(p.getFst());
    }
    this.transfer(t, outps);
  }
}
\end{numcodejava}
\caption{\C{SELECT} dataflow operator}
\label{fig:motivating-eg}
\end{figure}
