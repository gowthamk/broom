\section{Type Inference}
\label{sec:type-inference}

We formalize region type inference as an elaboration function from
programs in $\absof{\FB}$ (i.e., region-erased \FB) to programs in
\FB.  The type inference algorithm alternates between a constraint
generation phase and a constraint solving phase. During the generation
phase, inference algorithm introduces region variables ($\rho$) for
unknown region annotations on types, and constraint variables (denoted
$\varphi$) for unknown region constraints ($\phi$) on methods and
functions. Subsequently, the algorithm makes use of static semantics
in Fig.~\ref{fig:fb-staticsem} to generate constraints on region and
constraint variables. Due to the presence of region-polymorphic
recursion in \FB, constraints generated by the algorithm can be
circular. More precisely, constraints generated can assume the form
$\varphi \Leftrightarrow \phi \wedge F(\varphi)$, where $F$ is a
non-idempotent substitution function for region variables in
$\varphi$. In the constraint solving phase, the algorithm then relies
on a fixpoint constraint solving algorithm called \csolvestar to solve
the constraints and determine assignments for unknown region and
constraint variables.

\input{fb-elabexpr}
\input{fb-elabmeth}
