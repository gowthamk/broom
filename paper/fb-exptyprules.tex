%
\begin{minipage}{1.9in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
    \A = (\subtypcx) \spc
    \rgn \notin \rhoenv \\
    \rhoenv' = \rhoenv \cup \{\rgn\} \spc
    \phicx' = \phicx \conj \rhoenv \outlives \rgn\\
    \A' = (\rhoenv', \aenv, \phicx')\spc
    \hastyp{\A',\rgn,\env}{e}{\tau}
  }
  {
    \hastyp{\exptycx{\ralloc}{\env}}{\letregion{\rgn}{e}}{\tau}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
\begin{minipage}{2.3in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
    \tywf{\A}{\fbN} \spc
    fields(\fbN) = \taubar \\
    \hastyp{\exptycx{\ralloc}{\env}}{\bar{e}}{\bar{\tau'}} \spc
    \subtyp{\A}{\bar{\tau'}}{\taubar}\\
    \absof{\fbN} = \RgnZ\inang{T} \; \Rightarrow \;
    \allocRgn(\fbN)=\toprgn\\
%   allocRgn(\fbN) = \rgn \spc
%   \isvalid{\A.\phicx}{\rgn \outlives \ralloc}
  }
  {
    \hastyp{\exptycx{\ralloc}{\env}}{\C{new}\; \fbN(\bar{e})}{\fbN}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
\begin{minipage}{2.75in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
    \rbar \in \A.\rhoenv \spc
    \hastyp{\exptycx{\ralloc}{\env}}{\bar{e}}
        {\bar{\tau}}\spc\\
    \hastyp{\exptycx{\ralloc}{\env}}{e}
        {\inang{\rhoalloc\rhobar \,|\, \phi}
            \bar{\tau^1} \xrightarrow{\rgn} \tau^2}\\
    \substFn = \subst{\rbar}{\rhobar}
               \subst{\ralloc}{\rhoalloc} \spc
    \isvalid{\A.\phicx}{\substFn(\phi)} \spc
    \subtyp{\A}{\taubar}{\bar{\tau^1}}
  }
  {
    \hastyp{\A,\ralloc,\env}{e\inang{\ralloc\rbar}(\bar{e})}
           {\substFn(\tau^2)}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
\smallskip

%
\begin{minipage}{3.5in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
   \hastyp{\exptycx{\ralloc}{\env}}{x}
            {\RgnZ\inang{T}\inang{\rgn'}}\spc
    \A = (\subtypcx) \spc
    \rgn \notin \rhoenv \\
    \A' = (\rhoenv \cup \{\rgn\},\aenv,\phicx) \spc
    \env' =  \env[y\mapsto T@\rgn]\spc
    \hastyp{\A',\ralloc,\env'}{e}{\tau} 
  }
  {
    \hastyp{\exptycx{\ralloc}{\env}}{\open{x}{\rgn}{y}{e}}
            {\tau}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
\begin{minipage}{3.25in}
\begin{smathpar}
\begin{array}{c}
\renewcommand*{\arraystretch}{1.2}
\RULE
  {
%   \A = (\subtypcx)\spc
    \rhoalloc,\rhobar \notin \A.\rhoenv \spc
%   \rhoenv' = \rhoenv \cup \{\rhoalloc,\rhobar\}\spc
    \A' = (\A.\rhoenv \cup \{\rhoalloc,\rhobar\}, \A.\aenv, 
          \A.\phicx \conj \phi)\\
    \tywf{\A'.\rhoenv}{\phi}\spc
    \tywf{\A'}{\bar{\tau^1}}\spc
    \hastyp{\A',\rhoalloc,\env[\xbar \mapsto \bar{\tau^1}]}{e}{\tau^2}
  }
  {
    \hastyp{\exptycx{\ralloc}{\env}}
           {\lambdaexp{\rhoalloc\rhobar \,|\, \phi}
                      {\xbar:\bar{\tau^1}}{e}}
           {\inang{\rhoalloc\rhobar \,|\, \phi}
            \bar{\tau^1} \xrightarrow{\ralloc} \tau^2}
  }
\end{array}
\end{smathpar}
\end{minipage}
%
